<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOAT Awards Voting</title>
<style>
body {
    margin:0;
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
    color:#fff;
    text-align:center;
    overflow-x:hidden;
}
h1 {
    font-size: 36px;
    margin-top:20px;
    text-shadow: 2px 2px #000;
}
.card {
    background: rgba(0,0,0,0.7);
    width: 320px;
    margin: 20px auto;
    padding: 20px;
    border-radius:15px;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
}
.nominee-container {
    display:flex;
    justify-content:space-around;
    align-items:center;
    margin-bottom:15px;
}
.nominee-img {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius:50%;
    border: 3px solid #fff;
}
button.voteBtn {
    padding:10px 20px;
    margin:10px;
    font-size:16px;
    font-weight:bold;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#e63946;
    color:#fff;
}
button.voteBtn:disabled {
    background:#555;
    cursor:not-allowed;
}
.votes {
    font-size:22px;
    font-weight:bold;
    margin-top:5px;
}
.leader {
    color:red;
    animation: pulse 0.8s infinite;
}
@keyframes pulse {
    0% {transform: scale(1);}
    50% {transform: scale(1.3);}
    100% {transform: scale(1);}
}
.comment-section {
    background: rgba(255,255,255,0.1);
    padding:10px;
    margin-top:20px;
    border-radius:10px;
    text-align:left;
    max-height:300px;
    overflow-y:auto;
    display:none;
}
.comment {
    background: rgba(0,0,0,0.3);
    margin:5px 0;
    padding:5px 10px;
    border-radius:5px;
}
#countdown {
    font-size:20px;
    font-weight:bold;
    margin-top:10px;
    color:#ff4444;
}
.share-section {
    margin-top:15px;
}
.share-section button {
    padding:8px 15px;
    margin:5px;
    font-size:14px;
    border-radius:5px;
    border:none;
    background:#00b894;
    color:white;
    cursor:pointer;
}
.tiktok-follow {
    margin-top:10px;
    font-size:16px;
}
.tiktok-follow a {
    color:#ffe400;
    text-decoration:none;
    font-weight:bold;
}
.comment-toggle {
    margin-top:10px;
    padding:5px 10px;
    cursor:pointer;
    border:none;
    border-radius:5px;
    background:#0984e3;
    color:#fff;
    font-weight:bold;
}
input#commentInput {
    width:70%;
    padding:5px;
    margin-top:5px;
}
button#postComment {
    padding:5px 10px;
    margin-top:5px;
    cursor:pointer;
    border:none;
    border-radius:5px;
    background:#6c5ce7;
    color:white;
}
</style>
</head>
<body>

<h1>GOAT Awards Voting</h1>

<div id="countdown"></div>

<div class="card">
    <h2>Category: GOAT</h2>
    <div class="nominee-container">
        <img src="https://i.ibb.co/GQW8P8qN/images-16.jpg" class="nominee-img" alt="Messi">
        <img src="https://i.ibb.co/VWCzf1QP/images.jpg" class="nominee-img" alt="Ronaldo">
    </div>
    <div>
        <button class="voteBtn" onclick="vote('A')">Vote Messi</button>
        <button class="voteBtn" onclick="vote('B')">Vote Ronaldo</button>
    </div>
    <p class="votes" id="voteDisplayA">Messi: <span id="voteA">0</span></p>
    <p class="votes" id="voteDisplayB">Ronaldo: <span id="voteB">0</span></p>
</div>

<div class="card">
    <button class="comment-toggle" onclick="toggleComments()">Show/Hide Comments</button>
    <div class="comment-section" id="commentsContainer">
        <div id="comments"></div>
        <input type="text" id="commentInput" placeholder="Write your comment...">
        <button id="postComment" onclick="addComment()">Post</button>
    </div>
</div>

<div class="share-section">
    <button onclick="shareLink()">Share on Social Media</button>
</div>

<div class="tiktok-follow">
    <a href="https://www.tiktok.com/@prof.lord.peps?_r=1&_t=ZS-91yYLzVtT32" target="_blank">Follow on TikTok</a>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get, push, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

// Firebase config
const firebaseConfig = {
    apiKey: "AIzaSyAT9v-MfKjPpBHT58Iwt8JznDvwRjPIhqs",
    authDomain: "goat-awards.firebaseapp.com",
    projectId: "goat-awards",
    storageBucket: "goat-awards.firebasestorage.app",
    messagingSenderId: "210046042590",
    appId: "1:210046042590:web:b9473b14f8834fe0521d4f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const votesRef = ref(db, 'votes');
const commentsRef = ref(db, 'comments');

let userVoteTime = localStorage.getItem('userVoteTime') || 0;

// Starting votes
const startingVotes = { A:1823441, B:1895755 };

function updateVotesDisplay(votes){
    const voteA = votes.A || startingVotes.A;
    const voteB = votes.B || startingVotes.B;
    document.getElementById("voteA").innerText = voteA;
    document.getElementById("voteB").innerText = voteB;
    // Highlight leader
    if(voteA>voteB){
        document.getElementById("voteDisplayA").classList.add('leader');
        document.getElementById("voteDisplayB").classList.remove('leader');
    }else{
        document.getElementById("voteDisplayB").classList.add('leader');
        document.getElementById("voteDisplayA").classList.remove('leader');
    }
}

// Load votes from Firebase
onValue(votesRef, (snapshot)=>{
    let data = snapshot.val();
    if(!data){
        set(votesRef, startingVotes);
        data = startingVotes;
    }
    updateVotesDisplay(data);
});

// Countdown timer
function countdown(){
    const endDate = new Date("Dec 23, 2025 23:59:59").getTime();
    setInterval(()=>{
        let now = new Date().getTime();
        let distance = endDate - now;
        if(distance<0){
            document.getElementById('countdown').innerText="Voting ended!";
            return;
        }
        let days = Math.floor(distance/(1000*60*60*24));
        let hours = Math.floor((distance%(1000*60*60*24))/(1000*60*60));
        let minutes = Math.floor((distance%(1000*60*60))/(1000*60));
        let seconds = Math.floor((distance%(1000*60))/1000);
        document.getElementById('countdown').innerText = `Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
    },1000);
}

// Vote function with 30-min cooldown
function vote(person){
    const now = Date.now();
    if(now - userVoteTime < 30*60*1000){
        alert("You can vote only once every 30 minutes!");
        return;
    }
    // Redirect logic
    const redirect = confirm("You will be redirected briefly, click OK to continue.");
    if(!redirect) return;
    
    // After redirect
    setTimeout(()=>{
        get(votesRef).then((snapshot)=>{
            let data = snapshot.val() || startingVotes;
            if(person==='A') data.A++;
            if(person==='B') data.B++;
            set(votesRef, data);
            userVoteTime = Date.now();
            localStorage.setItem('userVoteTime', userVoteTime);
        });
    }, 1000);
}

// Comments toggle
function toggleComments(){
    const section = document.getElementById('commentsContainer');
    section.style.display = section.style.display==='none'?'block':'none';
}

// Load live comments
function loadComments(){
    onValue(commentsRef, (snapshot)=>{
        const data = snapshot.val() || [];
        const cDiv = document.getElementById('comments');
        cDiv.innerHTML='';
        const sorted = Object.values(data).sort((a,b)=>b.time - a.time); // newest first
        sorted.forEach(c=>{
            const div = document.createElement('div');
            div.className='comment';
            div.innerHTML=`<b>${c.user}</b>: ${c.text} <br><i>${new Date(c.time).toLocaleString()}</i>`;
            cDiv.appendChild(div);
        });
        cDiv.scrollTop = 0;
    });
}

// Add comment
function addComment(){
    const input = document.getElementById('commentInput');
    if(input.value.trim()==='') return;
    const newComment = {
        user:'You',
        text:input.value,
        time: Date.now()
    };
    push(commentsRef, newComment);
    input.value='';
}

// Random fan comments generator
function generateRandomComments(){
    const users = ['Fan123','SoccerKing','MessiFan','CR7Lover','GoalMachine','FutbolAddict'];
    const texts = [
        'CR7 is the real GOAT! üêê',
        'Messi all day ‚öΩüî•',
        'Ronaldo has no World Cup lol',
        'Messi too short for this award!',
        'Ronaldo forever the legend',
        'Messi or Ronaldo? tough choice!',
        'Up Ronaldo! üôå',
        'Messi fans rise! üí™',
        'CR7 can never lose üòé',
        'Messi is magic on the field'
    ];
    const randomIndex = Math.floor(Math.random()*users.length);
    const randomText = texts[Math.floor(Math.random()*texts.length)];
    const comment = {
        user: users[randomIndex],
        text: randomText,
        time: Date.now()
    };
    push(commentsRef, comment);
}
setInterval(generateRandomComments,10000); // Every 10s

// Share
function shareLink(){
    const shareText = "Vote now for the GOAT Awards! ‚öΩüî• Messi or Ronaldo? Support your GOAT!";
    window.open(`https://www.addtoany.com/share_save?link=https://goatawards.com&title=${encodeURIComponent(shareText)}`);
}

window.onload=function(){
    countdown();
    loadComments();
};
</script>
</body>
</html>
