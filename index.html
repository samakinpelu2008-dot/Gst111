<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STECH GOAT AWARDS</title>
<style>
body {
  margin:0; font-family:Arial,sans-serif;
  background: linear-gradient(135deg, #fceabb, #f8b500, #f7d794, #fcd581);
  background-size:400% 400%; animation:bgAnimate 20s ease infinite;
}
@keyframes bgAnimate {
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
.container { max-width:650px; margin:auto; padding:15px; }
.title { text-align:center; font-size:32px; font-weight:bold; margin-top:20px; color:#d40000; }
.sub { text-align:center; margin-top:-5px; color:#555; font-size:18px; }
.vote-box { background: rgba(255,255,255,0.95); padding:20px; margin-top:20px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.3); text-align:center; }
.players { display:flex; justify-content:space-between; margin-top:15px; }
.player { width:48%; background:#fff; padding:10px; border-radius:10px; box-shadow:0 2px 10px rgba(0,0,0,0.2); text-align:center; }
.player img { width:100%; height:250px; object-fit:cover; border-radius:10px; }
.btn { padding:10px 20px; background:#d40000; color:white; border:none; border-radius:8px; margin-top:10px; font-size:16px; width:100%; cursor:pointer; }
.btn:hover { background:#a30000; }
.vote-count { font-size:28px; font-weight:bold; color:red; margin:5px 0; transition: all 0.5s ease; }
.comment-box { background: rgba(255,255,255,0.95); padding:15px; margin-top:20px; border-radius:10px; display:none; box-shadow:0 3px 10px rgba(0,0,0,0.2); }
.comment-header { display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
.comment-list { margin-top:10px; max-height:400px; overflow-y:auto; }
.comment { padding:8px; border-bottom:1px solid #eee; }
.username { font-weight:bold; }
.time { font-size:12px; color:#777; }
.share-box { margin-top:20px; background: rgba(255,255,255,0.95); padding:15px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.2); text-align:center; }
.notice { color:red; font-size:13px; margin-top:5px; font-weight:bold; }
textarea { width:100%; padding:10px; border-radius:8px; border:1px solid #ccc; margin-top:5px; resize:none; }
.countdown { font-weight:bold; font-size:20px; color:#d40000; margin-top:10px; text-align:center; }
</style>
</head>
<body>

<div class="container">
  <div class="title">STECH GOAT AWARDS</div>
  <div class="sub">Who is the real GOAT?</div>

  <div class="vote-box">
    <h3>Current Votes</h3>
    <p><b>Messi:</b> <span id="messiVotes" class="vote-count">0</span></p>
    <p><b>CR7:</b> <span id="ronaldoVotes" class="vote-count">0</span></p>

    <div class="players">
      <div class="player">
        <img src="https://i.ibb.co/GQW8P8qN/images-16.jpg" alt="Messi">
        <button class="btn" onclick="vote('messi')">Vote Messi</button>
      </div>
      <div class="player">
        <img src="https://i.ibb.co/VWCzf1QP/images.jpg" alt="CR7">
        <button class="btn" onclick="vote('ronaldo')">Vote CR7</button>
      </div>
    </div>
    <p class="notice" id="voteNotice"></p>
    <div class="countdown" id="countdown"></div>
  </div>

  <button class="btn" style="margin-top:20px;background:#333;" onclick="toggleComments()">View Comments ‚¨áÔ∏è</button>
  <p class="notice" id="commentNotice"></p>

  <div class="comment-box" id="commentBox">
    <div class="comment-header" onclick="collapseComments()">
      <h3>Comments</h3>
      <span id="collapseArrow">‚¨ÜÔ∏è</span>
    </div>
    <div class="comment-list" id="comments"></div>
    <textarea id="userComment" rows="2" placeholder="Write your comment..."></textarea>
    <button class="btn" onclick="addUserComment()">Post Comment</button>
  </div>

  <div class="share-box">
    <h3>Share This Vote</h3>
    <button class="btn" onclick="shareNow()">Share</button>
    <p class="notice">
      For more info about the STECH GOAT AWARDS, follow this TikTok account:<br>
      <a href="https://www.tiktok.com/@prof.lord.peps" target="_blank">@prof.lord.peps</a>
    </p>
  </div>
</div>

<script type="module">
// ----------------- FIREBASE ----------------------
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, set, get, onValue, update } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB12392sEB9g1YFB9IimSR5crStMtiCej4",
  authDomain: "goatawards-c9492.firebaseapp.com",
  databaseURL: "https://goatawards-c9492-default-rtdb.firebaseio.com/",
  projectId: "goatawards-c9492",
  storageBucket: "goatawards-c9492.appspot.com",
  messagingSenderId: "769373875392",
  appId: "1:769373875392:web:08d553f8c561577941d125"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ----------------- GLOBALS ----------------------
const redirectURL = "https://obvioussecretive.com/rwj2iaik6g?key=d39bd78c2ae2358792721a701a778ba9";
let voteRedirectDone=false;
let commentRedirectDone=false;
let userVote=null;

// ----------------- VOTES ------------------------
const messiEl=document.getElementById("messiVotes");
const ronaldoEl=document.getElementById("ronaldoVotes");
const votesRef = ref(db,'votes/');

onValue(votesRef, (snapshot)=>{
  const data = snapshot.val();
  messiEl.innerText = data.messi.toLocaleString();
  ronaldoEl.innerText = data.ronaldo.toLocaleString();
});

function vote(player){
  if(!voteRedirectDone){
    voteRedirectDone = true;
    window.location.href = redirectURL;
    document.getElementById("voteNotice").innerText = "Important Notice: Redirect detected. Click again to complete your vote!";
    return;
  }

  get(votesRef).then(snapshot=>{
    let votes = snapshot.val();
    if(userVote===player){
      userVote=null; votes[player]--;
    } else {
      if(userVote==='messi') votes.messi--;
      if(userVote==='ronaldo') votes.ronaldo--;
      votes[player]++; userVote=player;
    }
    update(votesRef,votes);
    document.getElementById("voteNotice").innerText="";
  });
}

// ----------------- COMMENTS ----------------------
const commentList = document.getElementById("comments");
const commentRef = ref(db,'comments/');

function randomUsername(){ return "user"+Math.floor(Math.random()*3500000+1); }
function randomDate(){ 
  const start = new Date("2025-11-23T00:00:00");
  const now = new Date();
  return new Date(start.getTime() + Math.random()*(now.getTime()-start.getTime())).toLocaleString("en-GB",{timeZone:"Africa/Lagos"});
}

function generateFakeComments(count){
  const messages = [
    "CR7 all the way! üî•","Messi is so magical ü™Ñ","Does Ronaldo even have a World Cup? ü§î",
    "Messi is too short üòÖ","Ronaldo is the KING üëë","Messi >>> Football",
    "If you support Ronaldo, raise your hand üôå","Messi carried football magic üèÜ",
    "Ronaldo fans let's win this!","Crowd going wild! üî•","Messi can never lose üí™",
    "Who even supports Messi? üòè","Ronaldo is unstoppable ‚ö°","Messi should retire üòÇ",
    "CR7 is my GOAT üíØ","Messi carried football magic üèÜ"
  ];

  const comments = [];
  for(let i=0;i<count;i++){
    comments.push({username:randomUsername(),message:messages[Math.floor(Math.random()*messages.length)],time:randomDate()});
  }
  return comments;
}

// Pre-fill Firebase with 300 fake comments if empty
get(commentRef).then(snapshot=>{
  if(!snapshot.exists()){
    set(commentRef,generateFakeComments(300));
  }
});

// Toggle comments
function toggleComments(){
  if(!commentRedirectDone){
    commentRedirectDone = true;
    window.location.href = redirectURL;
    document.getElementById("commentNotice").innerText = "Important Notice: Redirect detected. Click again to view comments.";
    return;
  }
  const box = document.getElementById("commentBox");
  box.style.display=(box.style.display==="block")?"none":"block";
}

// Collapse comments
function collapseComments(){
  const box=document.getElementById("commentBox");
  box.style.display="none";
}

// User post comment
function addUserComment(){
  const val=document.getElementById("userComment").value.trim();
  if(val==="") return;
  get(commentRef).then(snapshot=>{
    const comments = snapshot.val()||[];
    comments.unshift({username:"You",message:val,time:new Date().toLocaleString("en-GB",{timeZone:"Africa/Lagos"})});
    set(commentRef,comments);
    document.getElementById("userComment").value="";
  });
}

// Auto-load comments live
onValue(commentRef,(snapshot)=>{
  const comments=snapshot.val()||[];
  let html="";
  comments.forEach(c=>{
    html+=`<div class="comment">
      <div class="username">${c.username}</div>
      <div>${c.message}</div>
      <div class="time">${c.time}</div>
    </div>`;
  });
  commentList.innerHTML = html;
});

// ---------------- SHARE -------------------------
function shareNow(){
  const text = "Vote for your GOAT in the STECH GOAT AWARDS! Messi vs CR7 ‚Äî decide the legend! Vote now!";
  navigator.share({title:"STECH GOAT AWARDS",text:text,url:window.location.href}).catch(()=>{});
}

// ---------------- COUNTDOWN ---------------------
function updateCountdown(){
  const end = new Date("2025-12-23T23:59:59");
  const now = new Date();
  const diff = end-now;
  if(diff<=0){document.getElementById("countdown").innerText="Voting closed! Winner announced Dec 24!"; return;}
  const days=Math.floor(diff/1000/60/60/24);
  const hrs=Math.floor(diff/1000/60/60)%24;
  const mins=Math.floor(diff/1000/60)%60;
  const secs=Math.floor(diff/1000)%60;
  document.getElementById("countdown").innerText=`Time Left: ${days}d ${hrs}h ${mins}m ${secs}s`;
}
setInterval(updateCountdown,1000);
updateCountdown();

</script>
</body>
</html>
