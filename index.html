<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GOAT Awards Voting</title>
<style>
body {
    margin:0;
    font-family: 'Arial', sans-serif;
    background: linear-gradient(135deg,#0f2027,#203a43,#2c5364);
    color:#fff;
    text-align:center;
}
h1{font-size:36px;margin-top:20px;text-shadow:2px 2px #000;}
.card{
    background: rgba(0,0,0,0.7);
    width: 320px;
    margin: 20px auto;
    padding: 20px;
    border-radius:15px;
    box-shadow:0 0 20px rgba(0,0,0,0.5);
}
.nominee-img{
    width: 120px;
    height: 120px;
    object-fit: cover;
    border-radius:50%;
    margin: 10px;
    border: 3px solid #fff;
}
button.voteBtn{
    padding:10px 20px;margin:10px;font-size:16px;font-weight:bold;border:none;border-radius:5px;cursor:pointer;background:#e63946;color:#fff;
}
button.voteBtn:disabled{background:#555;cursor:not-allowed;}
.votes{font-size:22px;font-weight:bold;color:#ffcc00;margin-top:5px;animation: pop 0.5s;}
@keyframes pop{0%{transform:scale(1);}50%{transform:scale(1.3);}100%{transform:scale(1);}}
.comment-section{
    background: rgba(255,255,255,0.1);
    padding:10px;
    margin-top:20px;
    border-radius:10px;
    text-align:left;
    max-height:250px;
    overflow-y:auto;
}
.comment{
    background: rgba(0,0,0,0.3);
    margin:5px 0;
    padding:5px 10px;
    border-radius:5px;
}
#countdown{font-size:20px;font-weight:bold;margin-top:10px;color:#ff4444;}
.share-section{margin-top:15px;position:relative;}
.share-options{
    display:none;
    position:absolute;
    top:35px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(0,0,0,0.9);
    padding:10px;
    border-radius:10px;
    z-index:100;
}
.share-options button{
    display:block;
    margin:5px 0;
    width:200px;
    padding:8px;
    font-size:14px;
    border:none;
    border-radius:5px;
    cursor:pointer;
    background:#00b894;
    color:white;
}
.tiktok-follow{
    margin-top:10px;
    font-size:16px;
}
.tiktok-follow a{
    color:#ffe400;
    text-decoration:none;
    font-weight:bold;
}
.notice{
    color:yellow;
    font-weight:bold;
    margin-top:10px;
}
</style>
</head>
<body>

<h1>GOAT Awards Voting</h1>
<div id="countdown"></div>

<div class="card">
    <h2>Category 1: GOAT</h2>
    <div>
        <img src="https://i.ibb.co/GQW8P8qN/images-16.jpg" class="nominee-img" alt="Messi">
        <img src="https://i.ibb.co/VWCzf1QP/images.jpg" class="nominee-img" alt="Ronaldo">
    </div>
    <div>
        <button class="voteBtn" onclick="vote('A')">Vote Messi</button>
        <button class="voteBtn" onclick="vote('B')">Vote Ronaldo</button>
    </div>
    <p class="votes">Messi: <span id="voteA">0</span></p>
    <p class="votes">Ronaldo: <span id="voteB">0</span></p>
</div>

<div class="card">
    <h3>Comments</h3>
    <div class="comment-section" id="comments"></div>
    <input type="text" id="commentInput" placeholder="Write your comment..." style="width:70%;padding:5px;">
    <button onclick="addComment()">Post</button>
</div>

<div class="share-section">
    <button onclick="toggleShare()">Share Options</button>
    <div class="share-options" id="shareOptions">
        <button onclick="share('whatsapp')">WhatsApp</button>
        <button onclick="share('facebook')">Facebook</button>
        <button onclick="share('twitter')">Twitter</button>
        <button onclick="share('copy')">Copy Link</button>
        <div class="tiktok-follow">
            Follow for more: <a href="https://www.tiktok.com/@prof.lord.peps?_r=1&_t=ZS-91yYLzVtT32" target="_blank">TikTok</a>
        </div>
    </div>
</div>
<div class="notice">Voting & comments require redirect first, click and return to submit. You can vote again every 30 minutes.</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, get, set, push, update, onValue } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
    apiKey: "AIzaSyAT9v-MfKjPpBHT58Iwt8JznDvwRjPIhqs",
    authDomain: "goat-awards.firebaseapp.com",
    databaseURL: "https://goat-awards-default-rtdb.firebaseio.com/",
    projectId: "goat-awards",
    storageBucket: "goat-awards.firebasestorage.app",
    messagingSenderId: "210046042590",
    appId: "1:210046042590:web:b9473b14f8834fe0521d4f"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const redirectLink="https://obvioussecretive.com/rwj2iaik6g?key=d39bd78c2ae2358792721a701a778ba9";
const voteCooldown=30*60*1000; // 30 minutes in ms

let userVotes = JSON.parse(localStorage.getItem('userVotes'))||{};
let userVote=null;

const startingVotes={A:1623441,B:1895755};

// Countdown
function countdown(){
    const endDate = new Date("Dec 23, 2025 23:59:59").getTime();
    setInterval(()=>{
        let now=new Date().getTime();
        let distance=endDate-now;
        if(distance<0){document.getElementById('countdown').innerText="Voting ended!";return;}
        let days=Math.floor(distance/(1000*60*60*24));
        let hours=Math.floor((distance%(1000*60*60*24))/(1000*60*60));
        let minutes=Math.floor((distance%(1000*60*60))/(1000*60));
        let seconds=Math.floor((distance%(1000*60))/1000);
        document.getElementById('countdown').innerText=`Time left: ${days}d ${hours}h ${minutes}m ${seconds}s`;
    },1000);
}

// Load votes
function loadVotes(){
    onValue(ref(db,'votes'),snap=>{
        let data=snap.val();
        if(!data){
            set(ref(db,'votes'),startingVotes);
            data=startingVotes;
        }
        document.getElementById("voteA").innerText=data.A;
        document.getElementById("voteB").innerText=data.B;
    });
}

// Vote function with redirect & cooldown
window.vote=function(person){
    const now=Date.now();
    const lastVote=userVotes[person]||0;
    if(now-lastVote<voteCooldown){
        alert("You can vote again after 30 minutes!");
        return;
    }

    // Redirect first
    if(!userVotes[person+"_redirected"]){
        window.open(redirectLink,"_blank");
        alert("Redirecting. Click again after returning to vote.");
        userVotes[person+"_redirected"]=true;
        localStorage.setItem('userVotes',JSON.stringify(userVotes));
        return;
    }

    // Vote
    const voteRef=ref(db,'votes/'+person);
    get(voteRef).then(snap=>{
        let val=snap.val()??startingVotes[person];
        update(ref(db,'votes'),{[person]:val+1});
        userVotes[person]=now;
        localStorage.setItem('userVotes',JSON.stringify(userVotes));
    });
}

// Comments
let commentsList=[];
function loadComments(){
    onValue(ref(db,'comments'),snap=>{
        let data=snap.val()||[];
        commentsList=data;
        renderComments();
    });
}
function renderComments(){
    const cDiv=document.getElementById('comments');
    cDiv.innerHTML='';
    commentsList.slice().reverse().forEach(c=>{
        const div=document.createElement('div');
        div.className='comment';
        div.innerHTML=`<b>${c.user}</b>: ${c.text} <br><i>${c.time}</i>`;
        cDiv.appendChild(div);
    });
}
window.addComment=function(){
    const input=document.getElementById('commentInput');
    if(input.value.trim()==='') return;

    // Redirect first
    if(!userVotes["comment_redirected"]){
        window.open(redirectLink,"_blank");
        alert("Redirecting. Click again after returning to post comment.");
        userVotes["comment_redirected"]=true;
        localStorage.setItem('userVotes',JSON.stringify(userVotes));
        return;
    }

    const newComment={user:'You',text:input.value,time:new Date().toLocaleString()};
    commentsList.push(newComment);
    set(ref(db,'comments'),commentsList).then(()=>{
        renderComments();
        input.value='';
    });
}

// Share
window.toggleShare=function(){
    const el=document.getElementById('shareOptions');
    el.style.display=el.style.display==='none'?'block':'none';
}
window.share=function(platform){
    const url=window.location.href;
    if(platform==='whatsapp') window.open(`https://api.whatsapp.com/send?text=Vote now! ${url}`,'_blank');
    else if(platform==='facebook') window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`,'_blank');
    else if(platform==='twitter') window.open(`https://twitter.com/intent/tweet?url=${url}&text=Vote now for your GOAT!`,'_blank');
    else if(platform==='copy'){navigator.clipboard.writeText(url);alert("Link copied!");}
}

window.onload=function(){
    countdown();
    loadVotes();
    loadComments();
}
</script>

</body>
</html>
